<div class="theory-management">
  <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
  <div class="header">
    <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏–º–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º–∏</h2>
    <p class="subtitle">–ó–¥–µ—Å—å –≤—ã –º–æ–∂–µ—Ç–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ —É–¥–∞–ª—è—Ç—å —Ä–∞–∑–¥–µ–ª—ã —Ç–µ–æ—Ä–∏–∏</p>
  </div>

  <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
  @if (error) {
    <div class="alert alert-error">
      <span class="error-icon">‚ö†Ô∏è</span>
      <p>{{ error }}</p>
      <button class="close-btn" (click)="error = null">√ó</button>
    </div>
  }

  @if (successMessage) {
    <div class="alert alert-success">
      <span class="success-icon">‚úì</span>
      <p>{{ successMessage }}</p>
      <button class="close-btn" (click)="successMessage = null">√ó</button>
    </div>
  }

  <!-- –§–æ—Ä–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è/—Å–æ–∑–¥–∞–Ω–∏—è -->
  @if (isEditing) {
    <div class="edit-form">
      <h3>{{ currentSection ? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞' : '–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞' }}</h3>

      <div class="form-grid">
        <div class="form-group">
          <label for="topic">–¢–µ–º–∞ *</label>
          <select
            id="topic"
            [(ngModel)]="formData.topic"
            class="form-control"
          >
            @for (topic of topics; track topic.value) {
              <option [value]="topic.value">{{ topic.label }}</option>
            }
          </select>
        </div>

        <div class="form-group">
          <label for="title">–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞ *</label>
          <input
            type="text"
            id="title"
            [(ngModel)]="formData.title"
            class="form-control"
            placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞"
          >
        </div>

        <div class="form-group">
          <label for="order">–ü–æ—Ä—è–¥–æ–∫ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è *</label>
          <input
            type="number"
            id="order"
            [(ngModel)]="formData.order"
            class="form-control"
            min="1"
            placeholder="1"
          >
          <small class="hint">–ß–µ–º –º–µ–Ω—å—à–µ —á–∏—Å–ª–æ, —Ç–µ–º –≤—ã—à–µ –≤ —Å–ø–∏—Å–∫–µ</small>
        </div>

        <div class="form-group">
          <label class="checkbox-label">
            <input
              type="checkbox"
              [(ngModel)]="formData.isActive"
            >
            <span>–ê–∫—Ç–∏–≤–Ω—ã–π —Ä–∞–∑–¥–µ–ª</span>
          </label>
          <small class="hint">–ù–µ–∞–∫—Ç–∏–≤–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—ã –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —Å—Ç—É–¥–µ–Ω—Ç–∞–º</small>
        </div>
      </div>

      <div class="form-group">
        <label for="content">–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞ *</label>
        <textarea
          id="content"
          [(ngModel)]="formData.content"
          class="form-control"
          rows="10"
          placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ HTML..."
        ></textarea>
        <small class="hint">–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å HTML-—Ä–∞–∑–º–µ—Ç–∫—É</small>
      </div>

      <div class="form-actions">
        <button
          class="btn btn-primary"
          (click)="saveSection()"
          [disabled]="isLoading"
        >
          @if (isLoading) {
            <span class="spinner"></span>
          }
          {{ currentSection ? '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è' : '–°–æ–∑–¥–∞—Ç—å —Ä–∞–∑–¥–µ–ª' }}
        </button>
        <button
          class="btn btn-secondary"
          (click)="cancelEdit()"
          [disabled]="isLoading"
        >
          –û—Ç–º–µ–Ω–∞
        </button>
      </div>
    </div>
  }

  <!-- –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
  <div class="control-panel">
    <div class="filters">
      <div class="filter-group">
        <label for="topicFilter">–§–∏–ª—å—Ç—Ä –ø–æ —Ç–µ–º–µ:</label>
        <select
          id="topicFilter"
          [(ngModel)]="selectedTopic"
          (change)="onTopicChange()"
          class="form-control"
        >
          <option value="all">–í—Å–µ —Ç–µ–º—ã</option>
          @for (topic of topics; track topic.value) {
            <option [value]="topic.value">{{ topic.label }}</option>
          }
        </select>
      </div>

      <div class="filter-group">
        <label for="search">–ü–æ–∏—Å–∫:</label>
        <div class="search-box">
          <input
            type="text"
            id="search"
            [(ngModel)]="searchQuery"
            (input)="onSearch()"
            class="form-control"
            placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏–ª–∏ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—é..."
          >
          @if (searchQuery) {
            <button class="clear-search" (click)="searchQuery = ''; onSearch()">√ó</button>
          }
        </div>
      </div>
    </div>

    <div class="actions">
      <button
        class="btn btn-success"
        (click)="createSection()"
        [disabled]="isLoading || isEditing"
      >
        + –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ä–∞–∑–¥–µ–ª
      </button>
      <button
        class="btn btn-refresh"
        (click)="loadSections()"
        [disabled]="isLoading"
      >
        @if (isLoading) {
          <span class="spinner"></span>
        } @else {
          üîÑ –û–±–Ω–æ–≤–∏—Ç—å
        }
      </button>
    </div>
  </div>

  <!-- –¢–∞–±–ª–∏—Ü–∞ —Ä–∞–∑–¥–µ–ª–æ–≤ -->
  <div class="sections-table">
    @if (isLoading && filteredSections.length === 0) {
      <div class="loading-state">
        <div class="spinner"></div>
        <p>–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–∞–∑–¥–µ–ª–æ–≤ —Ç–µ–æ—Ä–∏–∏...</p>
      </div>
    }

    @if (!isLoading && filteredSections.length === 0) {
      <div class="empty-state">
        <p>–†–∞–∑–¥–µ–ª—ã —Ç–µ–æ—Ä–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
        <p class="hint">–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π —Ä–∞–∑–¥–µ–ª –∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏</p>
      </div>
    }

    @if (!isLoading && filteredSections.length > 0) {
      <div class="table-responsive">
        <table class="table">
          <thead>
          <tr>
            <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
            <th>–¢–µ–º–∞</th>
            <th>–ü–æ—Ä—è–¥–æ–∫</th>
            <th>–°—Ç–∞—Ç—É—Å</th>
            <th>–û–±–Ω–æ–≤–ª–µ–Ω–æ</th>
            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
          </tr>
          </thead>
          <tbody>
            @for (section of filteredSections; track section.id) {
              <tr [class.inactive]="!section.isActive">
                <td class="title-cell">
                  <strong>{{ section.title }}</strong>
                  @if (!section.isActive) {
                    <span class="badge badge-warning">–ù–µ–∞–∫—Ç–∏–≤–Ω–æ</span>
                  }
                </td>
                <td>
                  <span class="topic-badge" [class]="'topic-' + section.topic">
                    {{ getTopicLabel(section.topic) }}
                  </span>
                </td>
                <td>{{ section.order }}</td>
                <td>
                  <span
                    class="status-badge"
                    [class.active]="section.isActive"
                    [class.inactive]="!section.isActive"
                  >
                    {{ section.isActive ? '–ê–∫—Ç–∏–≤–Ω–æ' : '–ù–µ–∞–∫—Ç–∏–≤–Ω–æ' }}
                  </span>
                </td>
                <td>
                  <small>{{ formatDate(section.updatedAt) }}</small>
                </td>
                <td class="actions-cell">
                  <button
                    class="btn-icon btn-edit"
                    (click)="editSection(section)"
                    [disabled]="isLoading"
                    title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å"
                  >
                    ‚úèÔ∏è
                  </button>
                  <button
                    class="btn-icon btn-toggle"
                    (click)="toggleSectionActive(section)"
                    [disabled]="isLoading"
                    [title]="section.isActive ? '–î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å' : '–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å'"
                  >
                    {{ section.isActive ? 'üëÅÔ∏è' : 'üëÅÔ∏è‚Äçüó®Ô∏è' }}
                  </button>
                  <button
                    class="btn-icon btn-delete"
                    (click)="deleteSection(section)"
                    [disabled]="isLoading"
                    title="–£–¥–∞–ª–∏—Ç—å"
                  >
                    üóëÔ∏è
                  </button>
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>

      <div class="table-footer">
        <small>–ü–æ–∫–∞–∑–∞–Ω–æ {{ filteredSections.length }} –∏–∑ {{ sections.length }} —Ä–∞–∑–¥–µ–ª–æ–≤</small>
      </div>
    }
  </div>
</div>
