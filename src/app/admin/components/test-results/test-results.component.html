<div class="test-results">
  <div class="results-header">
    <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤</h3>
    <div class="filters">
      <select class="filter-select" (change)="filterResults($event)">
        <option value="">–í—Å–µ —Ç–µ—Å—Ç—ã</option>
        <option value="calculator">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</option>
        <option value="sets">–¢–µ–æ—Ä–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤</option>
        <option value="matrices">–ú–∞—Ç—Ä–∏—Ü—ã</option>
      </select>
    </div>
  </div>

  @if (isLoading) {
    <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤...</div>
  } @else if (errorMessage) {
    <div class="error">{{ errorMessage }}</div>
  } @else {
    <div class="results-table">
      <table>
        <thead>
        <tr>
          <th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
          <th>–¢–µ—Å—Ç</th>
          <th>–î–∞—Ç–∞</th>
          <th>–†–µ–∑—É–ª—å—Ç–∞—Ç</th>
          <th>–û—Ü–µ–Ω–∫–∞</th>
          <th>–í—Ä–µ–º—è</th>
        </tr>
        </thead>
        <tbody>
          @for (result of testResults; track result.id) {
            <tr>
              <td>
                <div class="user-cell">
                  <div class="user-avatar">{{ getUserName(result).charAt(0) }}</div>
                  <div>
                    <strong>{{ getUserName(result) }}</strong>
                    <div class="user-email">{{ getUserEmail(result) }}</div>
                  </div>
                </div>
              </td>
              <td>{{ getTestName(result) }}</td>
              <td>{{ formatDate(result.completedAt) }}</td>
              <td>
                <div class="score-bar">
                  <div class="score-fill" [style.width.%]="result.score"></div>
                  <span>{{ result.score }}% ({{ result.correctCount }}/{{ result.totalCount }})</span>
                </div>
              </td>
              <td>
                <span class="grade-badge"
                      [class.excellent]="result.grade === '–û—Ç–ª–∏—á–Ω–æ'"
                      [class.good]="result.grade === '–•–æ—Ä–æ—à–æ'"
                      [class.average]="result.grade === '–£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ'">
                  {{ result.grade }}
                </span>
              </td>
              <td>{{ formatTimeSpent(result.timeSpent) }}</td>
            </tr>
          }
        </tbody>
      </table>
    </div>

    <div class="stats-summary">
      <div class="stat-item">
        <span class="stat-label">–í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ–π–¥–µ–Ω–æ:</span>
        <span class="stat-value">{{ totalTests }}</span>
      </div>
      <div class="stat-item">
        <span class="stat-label">–°—Ä–µ–¥–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:</span>
        <span class="stat-value">{{ averageScore }}%</span>
      </div>
      <div class="stat-item">
        <span class="stat-label">–õ—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:</span>
        <span class="stat-value">{{ bestScore }}%</span>
      </div>
    </div>

    <div class="export-section">
      <button class="btn-export" (click)="exportResults()">
        üì• –≠–∫—Å–ø–æ—Ä—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
      </button>
    </div>
  }
</div>
